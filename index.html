<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Laboratorijske ve≈æbe</title>

  <!-- AR.js -->
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.5/aframe/build/aframe-ar.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top, #2a3f6f, #0f172a);
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .app {
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(14px);
      border-radius: 24px;
      padding: 28px;
      width: 100%;
      max-width: 390px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.35);
    }
    .header { display:flex; gap:12px; align-items:center; }
    .logo { width:44px; height:44px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:22px; }
    h1 { margin:0; font-size:22px; }
    .subtitle { font-size:14px; opacity:.85; }
    .exercise-title { margin:14px 0 18px; font-size:16px; font-weight:600; color:#aeeaff; }
    .instructions { display:grid; gap:10px; margin-bottom:16px; }
    .step { background:rgba(255,255,255,.14); border-radius:14px; padding:12px 14px; display:flex; gap:10px; }
    video { width:100%; border-radius:16px; margin-bottom:16px; display:none; background:black; }
    button {
      width:100%; padding:15px; font-size:17px; font-weight:600;
      border:none; border-radius:16px;
      background:linear-gradient(135deg,#00e0ff,#4facfe);
      color:#002b36; cursor:pointer;
    }
    .footer { margin-top:16px; font-size:12px; text-align:center; opacity:.7; }

    /* AR scena je skrivena */
    a-scene { position: fixed; inset: 0; z-index: -1; }
  </style>
</head>

<body>
  <div class="app">
    <div class="header">
      <div class="logo">üß™</div>
      <div>
        <h1>Laboratorijske ve≈æbe</h1>
        <div class="subtitle">Multimedijalni edukativni sadr≈æaj</div>
      </div>
    </div>

    <div class="exercise-title">Usmeri kameru ka slici u praktikumu</div>

    <div class="instructions" id="instructions">
      <div class="step">1Ô∏è‚É£ Klikni na ‚ÄûPokreni ve≈æbu‚Äú</div>
      <div class="step">2Ô∏è‚É£ Dozvoli pristup kameri</div>
      <div class="step">3Ô∏è‚É£ Usmeri kameru ka slici</div>
      <div class="step">4Ô∏è‚É£ Video se automatski pokreƒáe</div>
    </div>

    <!-- Video koji zamenjuje kameru -->
    <video id="exerciseVideo" controls playsinline></video>

    <button id="toggleBtn" onclick="startAR()">‚ñ∂ Pokreni ve≈æbu</button>

    <div class="footer">¬© Edukativna platforma</div>
  </div>

  <!-- NEVIDLJIVA AR SCENA -->
  <a-scene
    embedded
    arjs="sourceType: webcam; facingMode: environment; debugUIEnabled: false;"
  >
    <a-camera></a-camera>

    <!-- 25 NEVIDLJIVIH MARKERA -->
    <!-- svaki marker zove istu funkciju sa svojim ID -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const scene = document.querySelector("a-scene");

        for (let i = 1; i <= 25; i++) {
          const num = String(i).padStart(2, "0");
          const marker = document.createElement("a-marker");
          marker.setAttribute("type", "pattern");
          marker.setAttribute("url", `markers/vezba${num}.patt`);
          marker.setAttribute("id", `vezba${num}`);
          marker.setAttribute("emitevents", "true");

          marker.addEventListener("markerFound", () => {
            onMarkerDetected(`vezba${num}`);
          });

          scene.appendChild(marker);
        }
      });
    </script>
  </a-scene>

  <script>
    const videoEl = document.getElementById("exerciseVideo");
    const instructions = document.getElementById("instructions");
    const button = document.getElementById("toggleBtn");

    let active = false;

    function startAR() {
      instructions.style.display = "none";
      button.textContent = "‚è≥ Tra≈æim sliku...";
      active = true;
    }

    function onMarkerDetected(markerId) {
      if (!active) return;
      active = false;

      const videoSrc = `videos/${markerId}.mp4`;

      // ugasi AR kameru
      const scene = document.querySelector("a-scene");
      scene.parentNode.removeChild(scene);

      // pusti video
      videoEl.src = videoSrc;
      videoEl.style.display = "block";
      videoEl.play();

      button.textContent = "‚èπ Zatvori video";
      button.onclick = () => window.location.reload();
    }
  </script>
</body>
</html>
