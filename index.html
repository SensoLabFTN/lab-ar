<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laboratorijske vežbe</title>

  <!-- HTML5 QR Code library -->
  <script src="https://unpkg.com/html5-qrcode@2.3.7/html5-qrcode.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
    #qr-reader { width: 100%; display: none; margin-bottom: 16px; }
    video, #videoPlayer {
    <div class="exercise-title" id="exerciseTitle">
      Izaberite laboratorijsku vežbu
    </div>

    <div class="instructions" id="instructions">
      <div class="step"><span>1️⃣</span> Klikni na dugme ispod</div>
      <div class="step"><span>2️⃣</span> Dozvoli pristup kameri</div>
      <div class="step"><span>3️⃣</span> Usmeri kameru ka QR kodu</div>
      <div class="step"><span>4️⃣</span> Video objašnjenje će se pojaviti</div>
    </div>

    <!-- QR code scanner -->
    <div id="qr-reader"></div>

    <!-- Video -->
    <video id="videoPlayer" controls></video>

    <button id="toggleBtn" onclick="toggleCamera()">▶ Pokreni vežbu</button>

    <div class="footer">
      © Edukativna platforma
    </div>
  </div>

  <script>
    let cameraOn = false;
    let html5QrScanner = null;

    const button = document.getElementById("toggleBtn");
    const instructions = document.getElementById("instructions");
    const qrReader = document.getElementById("qr-reader");
    const videoPlayer = document.getElementById("videoPlayer");
    const exerciseTitle = document.getElementById("exerciseTitle");

    function toggleCamera() {
      if (!cameraOn) {
        // Pokreni QR skener
        qrReader.style.display = "block";
        instructions.style.display = "none";

        html5QrScanner = new Html5Qrcode("qr-reader");

        html5QrScanner.start(
          { facingMode: "environment" },
          {
            fps: 10,
            qrbox: 250
          },
          qrCodeMessage => {
            // QR kod je prepoznat
            const code = qrCodeMessage.trim();
            handleQRCode(code);
            stopCamera();
          },
          errorMessage => {
            // ne radi ništa, samo greške u konzoli
            console.log("QR scan error:", errorMessage);
          }
        ).catch(err => {
          alert("Kamera nije dostupna ili dozvola nije data.");
        });

        button.textContent = "⏹ Zatvori kameru";
        cameraOn = true;

      } else {
        stopCamera();
      }
    }

    function stopCamera() {
      if (html5QrScanner) {
        html5QrScanner.stop().then(() => {
          html5QrScanner.clear();
        }).catch(err => console.log(err));
      }
      qrReader.style.display = "none";
      instructions.style.display = "grid";
      button.textContent = "▶ Pokreni vežbu";
      cameraOn = false;
    }

    function handleQRCode(code) {
      // Primer: code = "vezba1", "vezba2" ...
      const match = code.match(/vezba(\d+)/i);
      if (match) {
        const num = match[1];
        exerciseTitle.textContent = `Vežba ${num}`;
        videoPlayer.src = `videos/vezba${num}.mp4`;
        videoPlayer.style.display = "block";
        videoPlayer.play();
      } else {
        alert("Nepoznat QR kod");
      }
    }
  </script>
</body>
</html>
